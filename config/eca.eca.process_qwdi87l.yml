uuid: b0afaba1-c3dd-492b-b15e-02340a363209
langcode: en
status: true
dependencies:
  config:
    - field.field.node.certificate.field_remainder
    - field.field.node.vacation.field_state_vacation
    - field.field.node.vacation.field_vacation_s_employee_
    - field.storage.node.field_remainder
    - field.storage.node.field_state_vacation
    - field.storage.node.field_vacation_s_employee_
    - node.type.vacation
    - views.view.balance
    - views.view.vacations_waiting_for_approval
  module:
    - eca_base
    - eca_content
    - eca_tamper
    - eca_user
    - eca_views
id: process_qwdi87l
modeller: bpmn_io
label: 'Validation for TeamLead'
version: v1
weight: null
events:
  Event_1z02hz8:
    plugin: 'content_entity:update'
    label: 'Update Vacation'
    configuration:
      type: 'node vacation'
    successors:
      -
        id: Activity_1veccyk
        condition: ''
conditions:
  Flow_05qs4ag:
    plugin: eca_entity_field_value
    configuration:
      negate: false
      case: false
      expected_value: request_status_approved
      field_name: field_state_vacation
      operator: equal
      type: value
      entity: ''
  Flow_0ylwj1m:
    plugin: eca_scalar
    configuration:
      case: false
      left: '[countbal]'
      right: '0'
      operator: equal
      type: value
      negate: true
  Flow_08x0jfm:
    plugin: eca_scalar
    configuration:
      negate: false
      case: false
      left: '[countbal]'
      right: '0'
      operator: equal
      type: value
  Flow_1xpbq8g:
    plugin: eca_scalar
    configuration:
      case: false
      left: '[countwfa]'
      right: '0'
      operator: equal
      type: value
      negate: true
  Flow_142x6te:
    plugin: eca_scalar
    configuration:
      negate: false
      case: false
      left: '[wforapproval:0:field_numb_day]'
      right: '[balance]'
      operator: equal
      type: value
  Flow_00pdx0z:
    plugin: eca_scalar
    configuration:
      negate: false
      case: false
      left: '[wforapproval:0:field_numb_day]'
      right: '[balance]'
      operator: lessthan
      type: value
  Flow_0pdzy6p:
    plugin: eca_scalar
    configuration:
      negate: false
      case: false
      left: '[wforapproval:0:field_numb_day]'
      right: '[balance]'
      operator: greaterthan
      type: value
  Flow_1txnc2v:
    plugin: eca_scalar
    configuration:
      negate: false
      case: false
      left: '[countwfa]'
      right: '0'
      operator: equal
      type: value
  Flow_1d4kbua:
    plugin: eca_scalar
    configuration:
      case: false
      left: '[var]'
      right: '0'
      operator: equal
      type: value
      negate: true
  Flow_067qrjt:
    plugin: eca_scalar
    configuration:
      negate: false
      case: false
      left: '[var]'
      right: '0'
      operator: equal
      type: value
gateways:
  Gateway_0o0mfk7:
    type: 0
    successors:
      -
        id: Activity_0dm0pr4
        condition: Flow_0ylwj1m
      -
        id: Activity_1ihip22
        condition: Flow_08x0jfm
  Gateway_1a3hbxe:
    type: 0
    successors:
      -
        id: Gateway_0h0idvj
        condition: Flow_1xpbq8g
      -
        id: Activity_0911snz
        condition: Flow_1txnc2v
  Gateway_0h0idvj:
    type: 0
    successors:
      -
        id: Activity_0ixr64s
        condition: Flow_142x6te
      -
        id: Activity_0ixr64s
        condition: Flow_00pdx0z
      -
        id: Activity_0fbaaig
        condition: Flow_0pdzy6p
  Gateway_04lwx7p:
    type: 0
    successors:
      -
        id: Gateway_1a3hbxe
        condition: ''
  Gateway_14y9au9:
    type: 0
    successors:
      -
        id: Activity_0zvsj98
        condition: Flow_1d4kbua
      -
        id: Activity_02lazf9
        condition: Flow_067qrjt
actions:
  Activity_1veccyk:
    plugin: eca_token_load_entity
    label: 'Load entity [vacat]'
    configuration:
      token_name: vacat
      from: current
      entity_type: _none
      entity_id: ''
      revision_id: ''
      properties: ''
      langcode: _interface
      latest_revision: false
      unchanged: false
      object: ''
    successors:
      -
        id: Activity_16soxuz
        condition: Flow_05qs4ag
  Activity_01lfx1g:
    plugin: eca_views_query
    label: 'Load view Waiting For Approval [wforapproval]'
    configuration:
      token_name: wforapproval
      view_id: vacations_waiting_for_approval
      display_id: block_1
      arguments: ''
    successors:
      -
        id: Activity_0q4ktp9
        condition: ''
      -
        id: Activity_0jhlvii
        condition: ''
  Activity_0q4ktp9:
    plugin: eca_count
    label: 'Count list [countwfa]'
    configuration:
      token_name: countwfa
      list_token: wforapproval
    successors:
      -
        id: Activity_0o1wu85
        condition: ''
  Activity_0o1wu85:
    plugin: eca_token_set_value
    label: 'Token 0 [forapproval]'
    configuration:
      token_name: forapproval
      token_value: '0'
      use_yaml: false
    successors:
      -
        id: Activity_1a6c7ct
        condition: ''
  Activity_1a6c7ct:
    plugin: eca_views_query
    label: 'Load Balance [balanceview]'
    configuration:
      token_name: balanceview
      view_id: balance
      display_id: block_1
      arguments: ''
    successors:
      -
        id: Activity_0k8td9j
        condition: ''
  Activity_0k8td9j:
    plugin: eca_count
    label: 'Count certificate [countbal]'
    configuration:
      token_name: countbal
      list_token: balanceview
    successors:
      -
        id: Activity_1ft2h7d
        condition: ''
  Activity_1ft2h7d:
    plugin: eca_token_set_value
    label: 'Token 0 [balance]'
    configuration:
      token_name: balance
      token_value: '0'
      use_yaml: false
    successors:
      -
        id: Gateway_0o0mfk7
        condition: ''
  Activity_0dm0pr4:
    plugin: 'eca_tamper:math'
    label: 'Add field_remainder to balance'
    configuration:
      operation: addition
      flip: false
      value: '[balanceview:0:field_remainder]'
      eca_data: '[balance]'
      eca_token_name: balance
    successors:
      -
        id: Activity_13r8f3w
        condition: ''
  Activity_13r8f3w:
    plugin: 'eca_tamper:math'
    label: 'Subtraction 1 from countbal'
    configuration:
      operation: subtraction
      flip: false
      value: '1'
      eca_data: '[countbal]'
      eca_token_name: countbal
    successors:
      -
        id: Activity_1akarc9
        condition: ''
  Activity_1akarc9:
    plugin: eca_list_remove
    label: 'Drop first from [balanceview]'
    configuration:
      value: ''
      token_name: ''
      method: first
      index: ''
      list_token: balanceview
    successors:
      -
        id: Gateway_0o0mfk7
        condition: ''
  Activity_0ixr64s:
    plugin: 'eca_tamper:math'
    label: 'Subtraction 1 from countwfa'
    configuration:
      operation: subtraction
      flip: false
      value: '1'
      eca_data: '[countwfa]'
      eca_token_name: countwfa
    successors:
      -
        id: Activity_0xjxw3z
        condition: ''
      -
        id: Activity_1y64s3h
        condition: ''
  Activity_0fbaaig:
    plugin: eca_list_add_entity
    label: 'Add to list [needreject]'
    configuration:
      method: append
      index: ''
      list_token: needreject
      object: '[wforapproval:0]'
    successors:
      -
        id: Activity_0c7l093
        condition: ''
  Activity_0c7l093:
    plugin: eca_token_set_value
    label: 'Token 0 [var]'
    configuration:
      token_name: var
      token_value: '0'
      use_yaml: false
    successors:
      -
        id: Activity_0gt368w
        condition: ''
  Activity_0gt368w:
    plugin: 'eca_tamper:math'
    label: 'var + 1'
    configuration:
      operation: addition
      flip: false
      value: '1'
      eca_data: '[var]'
      eca_token_name: var
    successors:
      -
        id: Activity_1v0trck
        condition: ''
      -
        id: Activity_1ih4qos
        condition: ''
  Activity_1v0trck:
    plugin: eca_list_remove_entity
    label: 'Drop first from [wforapproval]'
    configuration:
      token_name: ''
      method: first
      index: ''
      list_token: wforapproval
      object: ''
    successors:
      -
        id: Activity_1le1eu8
        condition: ''
  Activity_1le1eu8:
    plugin: 'eca_tamper:math'
    label: 'Subtraction 1 from countwfa'
    configuration:
      operation: subtraction
      flip: false
      value: '1'
      eca_data: '[countwfa]'
      eca_token_name: countwfa
    successors:
      -
        id: Gateway_04lwx7p
        condition: ''
  Activity_0xjxw3z:
    plugin: eca_list_remove_entity
    label: 'Drop first from [wforapproval]'
    configuration:
      token_name: ''
      method: first
      index: ''
      list_token: wforapproval
      object: ''
    successors:
      -
        id: Gateway_04lwx7p
        condition: ''
  Activity_0911snz:
    plugin: eca_switch_account
    label: 'Switch to admin'
    configuration:
      user_id: '1'
    successors:
      -
        id: Gateway_14y9au9
        condition: ''
      -
        id: Activity_0tcw6v2
        condition: ''
  Activity_1hs6sm8:
    plugin: eca_set_field_value
    label: 'Set Reject into vacation'
    configuration:
      field_name: field_state_vacation.value
      field_value: request_status_rejected
      method: 'set:clear'
      strip_tags: false
      trim: false
      save_entity: true
      object: reject
    successors:
      -
        id: Activity_1kqramv
        condition: ''
      -
        id: Activity_0ucju1y
        condition: ''
  Activity_1kqramv:
    plugin: 'eca_tamper:math'
    label: 'Substartction 1 from var'
    configuration:
      operation: subtraction
      flip: false
      value: '1'
      eca_data: '[var]'
      eca_token_name: var
    successors:
      -
        id: Activity_1hxi129
        condition: ''
      -
        id: Activity_18zy5g5
        condition: ''
  Activity_1hxi129:
    plugin: eca_list_remove_entity
    label: 'Drop first from [needreject]'
    configuration:
      token_name: ''
      method: first
      index: ''
      list_token: needreject
      object: ''
    successors:
      -
        id: Gateway_14y9au9
        condition: ''
      -
        id: Activity_0kls0xv
        condition: ''
  Activity_02lazf9:
    plugin: action_message_action
    label: Activity_02lazf9
    configuration:
      replace_tokens: false
      message: 'Good job'
    successors: {  }
  Activity_16soxuz:
    plugin: eca_switch_account
    label: 'Switch to employee'
    configuration:
      user_id: '[node:field_vacation_s_employee_:target_id]'
    successors:
      -
        id: Activity_01lfx1g
        condition: ''
  Activity_1ihip22:
    plugin: eca_token_set_value
    label: 'Token 0 [countwfa]'
    configuration:
      token_name: countwfa
      token_value: '0'
      use_yaml: false
    successors:
      -
        id: Gateway_1a3hbxe
        condition: ''
  Activity_13r57id:
    plugin: action_message_action
    label: Activity_13r57id
    configuration:
      replace_tokens: false
      message: '1'
    successors: {  }
  Activity_0ucju1y:
    plugin: action_message_action
    label: Activity_0ucju1y
    configuration:
      replace_tokens: false
      message: '2'
    successors: {  }
  Activity_18zy5g5:
    plugin: action_message_action
    label: Activity_18zy5g5
    configuration:
      replace_tokens: false
      message: '3'
    successors: {  }
  Activity_0kls0xv:
    plugin: action_message_action
    label: Activity_0kls0xv
    configuration:
      replace_tokens: false
      message: '4'
    successors: {  }
  Activity_0zvsj98:
    plugin: eca_token_load_entity
    label: 'Set [needreject:0] into [reject]'
    configuration:
      token_name: reject
      from: id
      entity_type: node
      entity_id: '[needreject:0:nid]'
      revision_id: ''
      properties: ''
      langcode: _interface
      latest_revision: false
      unchanged: false
      object: ''
    successors:
      -
        id: Activity_1hs6sm8
        condition: ''
      -
        id: Activity_13r57id
        condition: ''
  Activity_0tcw6v2:
    plugin: action_message_action
    label: Activity_0tcw6v2
    configuration:
      replace_tokens: false
      message: 'start - [var]'
    successors: {  }
  Activity_1ih4qos:
    plugin: action_message_action
    label: Activity_1ih4qos
    configuration:
      replace_tokens: false
      message: work1
    successors: {  }
  Activity_1y64s3h:
    plugin: action_message_action
    label: Activity_1y64s3h
    configuration:
      replace_tokens: false
      message: work2
    successors: {  }
  Activity_0jhlvii:
    plugin: action_message_action
    label: Activity_0jhlvii
    configuration:
      replace_tokens: false
      message: '[wforapproval]'
    successors: {  }
